<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 780" role="img"
  aria-labelledby="title desc">
  <title id="title">Identity federation overview</title>
  <desc id="desc">Forest Admin acts as service provider upstream and identity provider downstream.</desc>
  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#f6f8fb" />
      <stop offset="100%" stop-color="#eef3ff" />
    </linearGradient>
    <marker id="arrow" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
      <path d="M0,0 L12,4 L0,8 z" fill="#355070" />
    </marker>
    <style>
      .title { font: 700 34px 'Segoe UI', Roboto, Arial, sans-serif; fill: #102a43; }
      .subtitle { font: 500 18px 'Segoe UI', Roboto, Arial, sans-serif; fill: #334e68; }
      .boundary { fill: none; stroke: #6b7280; stroke-width: 2; stroke-dasharray: 10 8; rx: 20; }
      .boundaryLabel { font: 600 18px 'Segoe UI', Roboto, Arial, sans-serif; fill: #475569; }
      .node { stroke-width: 2; rx: 16; ry: 16; }
      .user { fill: #fef3c7; stroke: #d97706; }
      .forest { fill: #dcfce7; stroke: #15803d; }
      .idp { fill: #e0e7ff; stroke: #4338ca; }
      .agent { fill: #e0f2fe; stroke: #0369a1; }
      .nodeTitle { font: 700 22px 'Segoe UI', Roboto, Arial, sans-serif; fill: #0f172a; }
      .nodeText { font: 500 16px 'Segoe UI', Roboto, Arial, sans-serif; fill: #334155; }
      .flow { stroke: #355070; stroke-width: 3; fill: none; marker-end: url(#arrow); }
      .flowLabel { font: 700 16px 'Segoe UI', Roboto, Arial, sans-serif; fill: #ffffff; }
      .circleBadge { fill: #355070; }
      .legendBox { fill: #ffffff; stroke: #cbd5e1; stroke-width: 1.5; rx: 8; ry: 8; }
      .legendTitle { font: 700 18px 'Segoe UI', Roboto, Arial, sans-serif; fill: #0f172a; }
      .legendText { font: 500 15px 'Segoe UI', Roboto, Arial, sans-serif; fill: #334155; }
    </style>
  </defs>

  <rect width="1400" height="780" fill="url(#bg)" />
  <text x="56" y="64" class="title">Identity Federation Topology</text>
  <text x="56" y="92" class="subtitle">Upstream login federation and downstream delegated access for
    agents</text>

  <rect x="452" y="108" width="900" height="248" class="boundary" />
  <text x="472" y="136" class="boundaryLabel">Upstream trust boundary: Forest as SP/RP</text>

  <rect x="452" y="416" width="900" height="260" class="boundary" />
  <text x="472" y="444" class="boundaryLabel">Downstream trust boundary: Forest as IDP</text>

  <rect x="84" y="302" width="250" height="154" class="node user" />
  <text x="108" y="344" class="nodeTitle">User / Frontend</text>
  <text x="108" y="370" class="nodeText">Admin console SPA</text>
  <text x="108" y="396" class="nodeText">Holds agent tokens</text>

  <rect x="508" y="278" width="346" height="178" class="node forest" />
  <text x="532" y="324" class="nodeTitle">Forest Admin Server</text>
  <text x="532" y="352" class="nodeText">SP upstream, IDP downstream</text>
  <text x="532" y="378" class="nodeText">Policy + token translation boundary</text>

  <rect x="1018" y="136" width="304" height="140" class="node idp" />
  <text x="1042" y="180" class="nodeTitle">Upstream IDP</text>
  <text x="1042" y="208" class="nodeText">OIDC / OAuth2 / SAML</text>

  <rect x="1018" y="500" width="304" height="160" class="node agent" />
  <text x="1042" y="544" class="nodeTitle">Cust. Hosted Agent</text>
  <text x="1042" y="572" class="nodeText">Validates Forest tokens</text>
  <text x="1042" y="600" class="nodeText">Hides behind firewall</text>

  <path d="M334 364 L508 364" class="flow" />
  <circle cx="421" cy="364" r="12" class="circleBadge" />
  <text x="421" y="369" class="flowLabel" text-anchor="middle">1</text>

  <path d="M854 330 C924 286 960 242 1018 204" class="flow" />
  <circle cx="936" cy="265" r="12" class="circleBadge" />
  <text x="936" y="270" class="flowLabel" text-anchor="middle">2a</text>

  <path d="M1018 246 C958 288 924 324 854 380" class="flow" />
  <circle cx="936" cy="305" r="12" class="circleBadge" />
  <text x="936" y="310" class="flowLabel" text-anchor="middle">2b</text>

  <path d="M508 430 L334 430" class="flow" />
  <circle cx="421" cy="430" r="12" class="circleBadge" />
  <text x="421" y="435" class="flowLabel" text-anchor="middle">3</text>

  <path d="M209 466 L1018 560" class="flow" />
  <circle cx="613" cy="513" r="12" class="circleBadge" />
  <text x="613" y="518" class="flowLabel" text-anchor="middle">4</text>

  <path d="M1018 640 L209 640" class="flow" />
  <circle cx="613" cy="640" r="12" class="circleBadge" />
  <text x="613" y="645" class="flowLabel" text-anchor="middle">5</text>

  <path d="M854 430 C 940 430 960 480 1018 510" class="flow" stroke-dasharray="5 5" />
  <circle cx="936" cy="465" r="12" class="circleBadge" />
  <text x="936" y="470" class="flowLabel" text-anchor="middle">6</text>

  <!-- Legend Box -->
  <rect x="84" y="500" width="350" height="230" class="legendBox" />
  <text x="100" y="530" class="legendTitle">Flow Sequence</text>
  <text x="100" y="560" class="legendText"><tspan font-weight="700">1.</tspan> User opens admin app</text>
  <text x="100" y="585" class="legendText"><tspan font-weight="700">2a.</tspan> Auth request (state,
    nonce)</text>
  <text x="100" y="610" class="legendText"><tspan font-weight="700">2b.</tspan> Assertion or ID
    token</text>
  <text x="100" y="635" class="legendText"><tspan font-weight="700">3.</tspan> Minted downstream
    token to Frontend</text>
  <text x="100" y="660" class="legendText"><tspan font-weight="700">4.</tspan> Fetch data directly
    from Agent (Bearer)</text>
  <text x="100" y="685" class="legendText"><tspan font-weight="700">5.</tspan> Data API Response
    directly to Frontend</text>
  <text x="100" y="710" class="legendText"><tspan font-weight="700">6.</tspan> SSE Control Push
    (Agent -> Server)</text>
</svg>
